{"version":3,"file":"index.js","sources":["../src/extendPrototype.js","../src/cachios.js","../src/index.js"],"sourcesContent":["// boilerplate helper method code inspired by axios/lib/core/Axios.js ;)\nconst datalessMethods = [\n  'delete',\n  'get',\n  'head',\n  'options',\n];\n\nconst dataMethods = [\n  'post',\n  'put',\n  'patch',\n];\n\nfunction extendPrototype(cachiosPrototype) {\n  datalessMethods.forEach((method) => {\n    cachiosPrototype[method] = function aliasDatalessMethod(url, config) {\n      const baseRequest = {\n        url,\n        method,\n      };\n\n      const mergedRequest = Object.assign(config || {}, baseRequest);\n\n      return this.request(mergedRequest);\n    };\n  });\n\n  dataMethods.forEach((method) => {\n    cachiosPrototype[method] = function aliasDataMethod(url, data, config) {\n      const baseRequest = {\n        url,\n        method,\n        data,\n      };\n\n      const mergedRequest = Object.assign(config || {}, baseRequest);\n\n      return this.request(mergedRequest);\n    };\n  });\n}\n\nexport default extendPrototype;\n","import extendPrototype from './extendPrototype';\n\nconst hash = require('object-hash');\nconst NodeCache = require('node-cache');\n\nfunction defaultCacheIdentifer(config) {\n  return {\n    method: config.method,\n    url: config.url,\n    params: config.params,\n    data: config.data,\n  };\n}\n\nfunction defaultResponseCopier(response) {\n  return {\n    status: response.status,\n    data: response.data,\n  };\n}\n\nfunction Cachios(axiosInstance, nodeCacheConf) {\n  this.axiosInstance = axiosInstance;\n  this.cache = new NodeCache(nodeCacheConf || {\n    stdTTL: 30,\n    checkperiod: 120,\n  });\n\n  this.getCacheIdentifier = defaultCacheIdentifer;\n  this.getResponseCopy = defaultResponseCopier;\n}\n\nCachios.prototype.getCacheKey = function getCacheKey(config) {\n  return hash(this.getCacheIdentifier(config));\n};\n\nCachios.prototype.getCachedValue = function getCachedValue(cacheKey) {\n  return this.cache.get(cacheKey);\n};\n\nCachios.prototype.setCachedValue = function setCachedValue(cacheKey, value, ttl) {\n  return this.cache.set(cacheKey, value, ttl);\n};\n\nCachios.prototype.request = function request(config) {\n  const { ttl } = config;\n\n  const cacheKey = this.getCacheKey(config);\n  const cachedValue = this.getCachedValue(cacheKey);\n\n  let promise;\n\n  if (cachedValue === undefined) {\n    promise = this.axiosInstance.request(config).then((resp) => {\n      this.setCachedValue(cacheKey, this.getResponseCopy(resp), ttl);\n      return resp;\n    });\n  } else {\n    promise = Promise.resolve(cachedValue);\n  }\n\n  return promise;\n};\n\nextendPrototype(Cachios.prototype);\n\nexport default Cachios;\n","import Cachios from './cachios';\n\nconst axios = require('axios');\n\nconst instance = new Cachios(axios);\n\n// allow for similar axios syntax\ninstance.create = function create(axiosInstance, nodeCacheConf) {\n  return new Cachios(axiosInstance, nodeCacheConf);\n};\n\nexport default instance;\n"],"names":["datalessMethods","dataMethods","extendPrototype","cachiosPrototype","forEach","method","aliasDatalessMethod","url","config","baseRequest","mergedRequest","request","aliasDataMethod","data","hash","require","NodeCache","defaultCacheIdentifer","params","defaultResponseCopier","response","status","Cachios","axiosInstance","nodeCacheConf","cache","getCacheIdentifier","getResponseCopy","prototype","getCacheKey","getCachedValue","cacheKey","get","setCachedValue","value","ttl","set","cachedValue","promise","undefined","then","resp","resolve","axios","instance","create"],"mappings":"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"}